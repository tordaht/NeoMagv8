<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔬 Morfolojik Diyalog Sistemi Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            border-left: 4px solid #4f46e5;
        }
        .morphological-analysis {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            font-family: monospace;
        }
        .consciousness-meter {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        .consciousness-level {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">
                🔬 Morfolojik Diyalog Sistemi Test
            </h1>
            <p class="text-gray-600">
                Training data + Türkçe morfoloji + Matematiksel skorlama
            </p>
        </div>

        <!-- Status Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">📚 Eğitim Verisi</h3>
                <p class="text-3xl font-bold text-blue-600" id="trainingCount">-</p>
                <p class="text-sm text-gray-500">Örnek sayısı</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">🎭 Context'ler</h3>
                <p class="text-3xl font-bold text-green-600" id="contextCount">-</p>
                <p class="text-sm text-gray-500">Farklı bağlam</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">🧠 Bilinç Seviyesi</h3>
                <div class="consciousness-meter mb-2">
                    <div class="consciousness-level" id="consciousnessBar" style="width: 70%"></div>
                </div>
                <p class="text-sm text-gray-500" id="consciousnessValue">0.70</p>
            </div>
        </div>

        <!-- Test Controls -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">🎮 Test Kontrolleri</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Context Seçimi</label>
                    <select id="contextSelect" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="philosophical">🤔 Philosophical</option>
                        <option value="social">👥 Social</option>
                        <option value="creative">🎨 Creative</option>
                        <option value="self-reflection">🪞 Self-reflection</option>
                        <option value="scientific">🔬 Scientific</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Cümle Tipi</label>
                    <select id="sentenceTypeSelect" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="simple">🔸 Simple (SOV)</option>
                        <option value="complex">🔶 Complex (Locative)</option>
                        <option value="emotional">💝 Emotional</option>
                        <option value="locative">📍 Locative (From-To)</option>
                    </select>
                </div>
            </div>

            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Bilinç Seviyesi: <span id="consciousnessSliderValue">0.7</span>
                </label>
                <input type="range" id="consciousnessSlider" min="0.1" max="1.0" step="0.1" value="0.7" 
                       class="w-full">
            </div>

            <div class="flex flex-wrap gap-4 mt-6">
                <button onclick="generateSingleSentence()" 
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">
                    🎯 Tek Cümle Üret
                </button>
                <button onclick="generateDialogue()" 
                        class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">
                    💬 Diyalog Üret
                </button>
                <button onclick="testMorphology()" 
                        class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition">
                    🔤 Morfoloji Test
                </button>
                <button onclick="runFullTest()" 
                        class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition">
                    🚀 Tam Test
                </button>
            </div>
        </div>

        <!-- Results -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">📊 Test Sonuçları</h3>
            <div id="testResults" class="space-y-4">
                <p class="text-gray-500 text-center py-8">
                    Test butonlarından birine tıklayarak başlayın...
                </p>
            </div>
        </div>
    </div>

    <script type="module">
        // Import the modules
        import AITrainingAdapter from './src/engine/AITrainingAdapter.js';
        import { generateMorphSentence, generateMorphDialogue, addCase, LEXICON, testMorphologicalGenerator } from './src/engine/MorphologicalDialogueGenerator.js';

        let aiAdapter = null;

        // Initialize
        async function initialize() {
            try {
                aiAdapter = new AITrainingAdapter();
                
                // Wait for data to load
                await new Promise(resolve => {
                    const checkLoaded = () => {
                        if (aiAdapter.isLoaded) {
                            resolve();
                        } else {
                            setTimeout(checkLoaded, 100);
                        }
                    };
                    checkLoaded();
                });

                updateStatus();
                console.log('✅ Morfolojik test sistemi hazır!');
                
            } catch (error) {
                console.error('❌ Initialization error:', error);
                addTestResult('Sistem Hatası', `Initialization failed: ${error.message}`, 'error');
            }
        }

        function updateStatus() {
            if (!aiAdapter || !aiAdapter.isLoaded) return;

            const status = aiAdapter.getSystemStatus();
            
            document.getElementById('trainingCount').textContent = status.trainingExamples;
            document.getElementById('contextCount').textContent = status.contexts.length;
            
            // Consciousness slider güncelleme
            const consciousnessSlider = document.getElementById('consciousnessSlider');
            const consciousnessValue = document.getElementById('consciousnessValue');
            const consciousnessBar = document.getElementById('consciousnessBar');
            const consciousnessSliderValue = document.getElementById('consciousnessSliderValue');
            
            consciousnessSlider.addEventListener('input', (e) => {
                const value = e.target.value;
                consciousnessValue.textContent = value;
                consciousnessSliderValue.textContent = value;
                consciousnessBar.style.width = (value * 100) + '%';
            });
        }

        function addTestResult(title, content, type = 'info', extra = '') {
            const resultsDiv = document.getElementById('testResults');
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type === 'error' ? 'bg-red-500' : ''}`;
            
            resultDiv.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <h4 class="font-semibold text-lg">${title}</h4>
                    <span class="text-xs opacity-75">${new Date().toLocaleTimeString()}</span>
                </div>
                <p class="mb-2">${content}</p>
                ${extra ? `<div class="morphological-analysis">${extra}</div>` : ''}
            `;
            
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild);
        }

        // Global functions for buttons
        window.generateSingleSentence = async function() {
            if (!aiAdapter) return;
            
            const context = document.getElementById('contextSelect').value;
            const sentenceType = document.getElementById('sentenceTypeSelect').value;
            const consciousness = parseFloat(document.getElementById('consciousnessSlider').value);
            
            try {
                // Training-aware generation
                const trainingSentence = await aiAdapter.generateTrainingAwareMorphSentence(
                    context, consciousness
                );
                
                // Basic generation for comparison
                const basicSentence = await generateMorphSentence(null, sentenceType);
                
                addTestResult(
                    `🎯 Tek Cümle (${context}, ${consciousness.toFixed(1)})`,
                    `<strong>Training-aware:</strong> ${trainingSentence}<br>
                     <strong>Basic:</strong> ${basicSentence}`,
                    'info',
                    `Context: ${context} | Type: ${sentenceType} | Consciousness: ${consciousness}`
                );
                
            } catch (error) {
                addTestResult('Hata', `Cümle üretilirken hata: ${error.message}`, 'error');
            }
        };

        window.generateDialogue = async function() {
            if (!aiAdapter) return;
            
            const context = document.getElementById('contextSelect').value;
            const consciousness = parseFloat(document.getElementById('consciousnessSlider').value);
            
            try {
                const trainingDialogue = await aiAdapter.generateTrainingAwareMorphDialogue(
                    context, 3, consciousness
                );
                
                const basicDialogue = await generateMorphDialogue(3);
                
                addTestResult(
                    `💬 Diyalog (${context})`,
                    `<strong>Training-aware:</strong><br>${trainingDialogue}<br><br>
                     <strong>Basic:</strong><br>${basicDialogue}`,
                    'info',
                    `3 cümle | Consciousness: ${consciousness} | Context: ${context}`
                );
                
            } catch (error) {
                addTestResult('Hata', `Diyalog üretilirken hata: ${error.message}`, 'error');
            }
        };

        window.testMorphology = function() {
            const testWords = ['bakteri', 'enerji', 'düşünce', 'hayal', 'kristal'];
            const cases = [
                { role: 'nom', name: 'Nominative (Yalın)' },
                { role: 'acc', name: 'Accusative (Belirtme)' },
                { role: 'dat', name: 'Dative (Yönelme)' },
                { role: 'loc', name: 'Locative (Bulunma)' },
                { role: 'abl', name: 'Ablative (Çıkma)' },
                { role: 'gen', name: 'Genitive (İlgi)' }
            ];
            
            let morphResults = '<table class="w-full text-sm"><tr><th>Kelime</th>';
            cases.forEach(c => morphResults += `<th>${c.name}</th>`);
            morphResults += '</tr>';
            
            testWords.forEach(word => {
                morphResults += `<tr><td class="font-bold">${word}</td>`;
                cases.forEach(c => {
                    const result = addCase(word, c.role);
                    morphResults += `<td>${result}</td>`;
                });
                morphResults += '</tr>';
            });
            morphResults += '</table>';
            
            addTestResult(
                '🔤 Morfoloji Analizi',
                'Türkçe ünlü uyumu ve durum ekleri test sonuçları:',
                'info',
                morphResults
            );
        };

        window.runFullTest = async function() {
            if (!aiAdapter) return;
            
            addTestResult('🚀 Tam Test Başlıyor', 'Tüm sistemler test ediliyor...', 'info');
            
            try {
                // System status
                const status = aiAdapter.getSystemStatus();
                addTestResult(
                    '📊 Sistem Durumu',
                    `Training examples: ${status.trainingExamples}<br>
                     Contexts: ${status.contexts.join(', ')}<br>
                     Top contexts: ${status.topContexts.map(c => `${c.context} (${c.avgSuccess})`).join(', ')}`,
                    'info'
                );
                
                // Test different contexts
                const contexts = ['philosophical', 'social', 'creative'];
                
                for (const context of contexts) {
                    const sentence = await aiAdapter.generateTrainingAwareMorphSentence(context, 0.8);
                    const dialogue = await aiAdapter.generateTrainingAwareMorphDialogue(context, 2, 0.7);
                    
                    addTestResult(
                        `🧪 Context: ${context}`,
                        `<strong>Sentence:</strong> ${sentence}<br>
                         <strong>Dialogue:</strong> ${dialogue}`,
                        'info'
                    );
                }
                
                // Morphological integration test
                await aiAdapter.testMorphologicalIntegration();
                
                addTestResult('✅ Tam Test Tamamlandı', 'Tüm testler başarıyla geçildi!', 'info');
                
            } catch (error) {
                addTestResult('Hata', `Tam test hatası: ${error.message}`, 'error');
            }
        };

        // Initialize on page load
        initialize();
    </script>
</body>
</html> 